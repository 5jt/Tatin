 r←Test_ClientConfig_121(stopFlag batchFlag);⎕TRAP;tempDir;settings;ns;parms;reg1;reg2;reg
⍝ Add a URL twice with different alias names and make that accessing with URL throws an error (ambiguous)
 ⎕TRAP←(999 'C' '. ⍝ Deliberate error')(0 'N')
 r←T._Failed

 tempDir←GetTempDir''
 F.DeleteFile tempDir,'/',TC.UserSettings.cfg_name               ⍝ Precaution

 settings←⎕NEW TC.UserSettings(,⊂tempDir)
 →T.GoToTidyUp 2≠≢settings.registries

 parms←⎕NS''
 parms.uri←'[alias1]https://localhost'
 parms.alias←'alias1'
 parms.api_key←'First-one'
 reg1←⎕NEW TC.DefineRegistry(,⊂parms)
 settings.AddRegistry reg1

 parms.alias←'alias2'
 parms.api_key←'Second-one'
 reg2←⎕NEW TC.DefineRegistry(,⊂parms)
 settings.AddRegistry reg2

 →T.GoToTidyUp 4≠≢settings.registries

 reg←settings.GetRegistry'[alias1]'
 →T.GoToTidyUp'alias1'≢reg.alias
 →T.GoToTidyUp'First-one'≢reg.api_key

 reg←settings.GetRegistry'[alias2]'
 →T.GoToTidyUp'alias2'≢reg.alias
 →T.GoToTidyUp'Second-one'≢reg.api_key

 r←T._OK

∆TidyUp:
 F.RmDir tempDir
⍝Done
